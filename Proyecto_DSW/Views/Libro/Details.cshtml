@model Proyecto_DSW.Models.Libro

@{
    ViewData["Title"] = "Detalles del Libro";
    var usuarioId = ViewBag.IdUsuario ?? 1;
}

<link rel="stylesheet" href="~/css/DetallesLibro.css" />

<div class="detalles-container">
    <div class="detalles-header">
        <h1>@Model.titulo</h1>
    </div>

    <div class="libro-grid">
        <!-- Información del Libro -->
        <div class="libro-info-card">
            <h2 class="libro-title">@Model.titulo</h2>

            <div class="libro-meta">
                <div class="meta-item">
                    <span class="meta-label">Autor:</span>
                    <span class="meta-value">@Model.autor</span>
                </div>

                <div class="meta-item">
                    <span class="meta-label">Categoría:</span>
                    <span class="meta-value">@Model.Categoria?.nombre</span>
                </div>
            </div>

            <div class="libro-descripcion">
                <span class="descripcion-label">Descripción:</span>
                <p class="descripcion-text">@Model.descripcion</p>
            </div>

            <div class="libro-precio">
                <div class="precio-label">Precio</div>
                <div class="precio-valor">S/. @Model.precio</div>
            </div>

            <div class="libro-stock">
                <span class="stock-label">Disponible:</span>
                <span class="stock-value">@Model.stock unidades</span>
            </div>

            <div class="cantidad-control">
                <span class="cantidad-label">Cantidad:</span>
                <input type="number" id="Cantidad" name="Cantidad" class="cantidad-input" value="1" min="1" max="@Model.stock" />
            </div>

            <div class="libro-actions">
                <div class="actions-title">¿Te interesa?</div>
                <p class="actions-text">Añade este libro a tu carrito ahora mismo.</p>

                <form asp-controller="Carrito" asp-action="Agregar" method="post">
                    <input type="hidden" name="IdUsuario" value="@usuarioId" />
                    <input type="hidden" name="IdLibro" value="@Model.id_libro" />
                    <input type="hidden" name="Cantidad" value="1" id="hiddenCantidad" />
                    <button type="submit" class="btn-agregar-carrito">
                        Añadir al Carrito
                    </button>
                </form>
            </div>
        </div>

        <!-- Imagen del Libro -->
        <div class="libro-imagen-card">
            @if (!string.IsNullOrEmpty(Model.imagen))
            {
                <img src="@Model.imagen" alt="@Model.titulo" class="libro-imagen" />
            }
            else
            {
                <div class="imagen-placeholder">
                    <span>No hay imagen disponible</span>
                </div>
            }
        </div>
    </div>

    <div class="detalles-footer">
        <a asp-action="Index" class="btn-volver">Volver al Listado</a>
    </div>
</div>

@section Scripts {
    <script>
        const cantidadInput = document.getElementById('Cantidad');
        const hiddenInput = document.getElementById('hiddenCantidad');

        cantidadInput.addEventListener('input', function () {
            hiddenInput.value = cantidadInput.value;
        });

        // Validar cantidad máxima
        cantidadInput.addEventListener('change', function () {
            if (this.value > @Model.stock) {
                this.value = @Model.stock;
                hiddenInput.value = @Model.stock;
            }
        });
    </script>
}